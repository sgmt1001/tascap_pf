<div class="container">
  <div class="row my-3">
    <div class="col-lg-12">

      <h1>organization detail</h1>
      <% if @organization.user_id == current_user.id %>
        <p>
          <%= link_to 'edit',edit_organization_path(@organization.id) %>
          <%= link_to 'delete',organization_path(@organization.id),method: :delete, data: { confirm: '本当に消しますか？' } %>
        </p>
      <% end %>
      <table class='table'>
        <thead>
          <tr>
            <th>name</th>
            <th>owner</th>
            <th>belonging</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><%= @organization.name %></td>
            <td><%= link_to User.find(@organization.user_id).name, user_path(@user.id) %></td>
            <td><%= link_to Belonging.where(organization_id: @organization.id).count, organization_belonging_path(@organization) %></td>
          </tr>
        </tbody>
      </table>

      <table class='table'>
        <thead>
          <tr>
            <th>introduction</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><%= simple_format(@organization.introduction) %></td>
          </tr>
        </tbody>
      </table>

      <h3>projects</h3>
      <P><%= link_to 'new project',new_organization_project_path(@organization.id) %></P>

      <table class='table'>
          <thead>
            <tr>
              <th>name</th>
              <th>man hour(project)</th>
              <th>owner</th>
              <th>member</th>
            </tr>
          </thead>
          <tbody>
            <% @organization.projects.each do |project| %>
            <tr>
              <td>
                <% if project.members.exists?(user_id: current_user.id )%>
                  <%= link_to project.name, organization_project_path(@organization.id,project.id) %>
                <% else %>
                  <%= project.name %>
                <% end %>
              </td>
              <td><%= Task.where(project_id: project.id).sum(:man_hour)%></td>
              <td><%= link_to User.find(project.user_id).name, user_path(@user.id) %></td>
              <td><%= link_to Member.where(project_id: project.id).count, project_member_path(@organization.id, project.id) %></td>
            </tr>
            <% end %>
          </tbody>
        </table>

    </div>
  </div>
</div>