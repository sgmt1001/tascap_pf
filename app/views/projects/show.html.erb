<div class="container">
  <div class="row my-3">
    <div class="col-lg-4">
      <h1>project detail</h1>

      <p class="font-weight-bold border-bottom">organization</p>
      <p><%= link_to @project.organization.name, organization_path(@project.organization_id) %></p>

      <p class="font-weight-bold border-bottom">project</p>
      <span class="font-weight-bold">name</span>
      <br>
      <span><%= @project.name %></span>
      <br>
      <span class="font-weight-bold">owner</span>
      <br>
      <span><%= link_to User.find(@project.user_id).name, user_path(@project.user_id) %></span>
      <br>
      <span class="font-weight-bold">overview</span>
      <p><%= simple_format(@project.overview) %></p>
      <p>
        <% if @project.user_id == current_user.id %>
          <p>
            <%= link_to 'edit',edit_organization_project_path(@project.id) %>
            <%= link_to 'delete',organization_project_path(@project.id),method: :delete, data: { confirm: '本当に消しますか？' } %>
          </p>
        <% end %>
      </p>
      <table style="width :100%">
        <thead>
          <tr>
            <th class="font-weight-bold border-bottom">member</th>
            <th class="font-weight-bold border-bottom">spendable</th>
            <th class="font-weight-bold border-bottom">man hour </th>
            <th class="font-weight-bold border-bottom">capacity</th>
          </tr>
        </thead>
        <tbody>
          <% @project.members.each do |member| %>
          <tr>
            <td>
              <span><%= attachment_image_tag(member.user, :profile_image, :fill, 100, 100, fallback: "no-image-icon.jpeg", size: '40x40') %></span>
              <span><%= link_to member.user.name, user_path(member.user_id) %></span>
            </td>
            <td><%= link_to member.spendable_hour, project_member_spendable_path(@project.organization_id, @project.id,member.id) %>h</td>
            <td><%= Task.where(person: member.user.name ).sum(:man_hour) %></td>
            <td>
              <% if member.spendable_hour != 0 %><%# spndableが0の時に、zerodivisionerrorを回避するための記述%>
                <%= (Task.where(person: member.user.name ).sum(:man_hour).to_f/member.spendable_hour.to_f*100).round(2) %>%
              <% else %>
                <%= '-' %>
              <% end %>
            </td>
          </tr>
          <% end %>
        </tbody>
      </table>
      <p>
        <%= link_to 'members', project_member_path(@project.organization_id,@project.id) %>
      </p>
    </div>

    <div class="col-lg-8">
      <table class='table'>
        <p>
          <%= link_to 'new task',new_organization_project_task_path(@project.organization_id,@project.id) %>
        </p>
        <thead>
          <tr>
            <th>task</th>
            <th>man hour</th>
            <th>deadline</th>
            <th>status</th>
            <th>person</th>
          </tr>
        </thead>
        <tbody>
          <% @project.tasks.each do |task| %>
          <tr>
            <td><%= link_to task.name,organization_project_task_path(@project.organization.id,@project.id,task.id) %></td>
            <td><%= task.man_hour %></td>
            <td><%= task.deadline.strftime("%Y/%m/%d %H:%M") %></td>
            <td><%= task.status %></td>
            <td><%= task.person %></td>
          </tr>
          <% end %>
        </tbody>
      </table>
    </div>

  </div>
</div>